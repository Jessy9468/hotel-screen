<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8" />
    <title>√âcran tarifs & infos - Ibis Vitr√©</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }

        html, body {
            width: 100%;
            height: 100%;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            background: #000;
            color: #fff;
        }

        body {
            width: 100vw;
            height: 100vh;
            overflow: hidden;
        }

        /* Logo en haut √† droite */
        .logo-container {
            position: fixed;
            top: 12px;
            right: 24px;
            z-index: 20;
        }
        .logo-container img {
            max-height: 70px;
            width: auto;
            object-fit: contain;
            display: block;
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.6));
        }

        /* Grille principale */
        .layout {
            display: grid;
            grid-template-columns: 1.25fr 1fr;
            gap: 16px;
            padding: 16px;
            width: 100vw;
            height: 100vh;
            transform-origin: top left; /* pour le zoom dynamique */
        }

        .panel {
            background: #111;
            border-radius: 16px;
            padding: 16px 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.4);
            display: flex;
            flex-direction: column;
            min-width: 0;
            min-height: 0;
        }

        .panel-widgets {
            overflow-y: auto;
            overflow-x: hidden;
        }
        .panel-widgets::-webkit-scrollbar {
            width: 0;
            height: 0;
        }

        .panel-title {
            font-size: 28px;
            font-weight: 700;
            text-align: center;
            margin-bottom: 10px;
        }
        .panel-subtitle {
            font-size: 14px;
            text-align: center;
            opacity: 0.8;
            margin-bottom: 12px;
        }

        .rate-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            font-size: 14px;
            opacity: 0.9;
        }
        .rate-date { font-weight: 600; }

        .rates-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 8px;
            font-size: 18px;
        }
        .rates-table thead tr { background: #CC0033; }
        .rates-table thead th {
            padding: 10px 12px;
            text-align: left;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: .05em;
        }
        .rates-table tbody tr:nth-child(odd) { background: #E5093B; }
        .rates-table tbody tr:nth-child(even){ background: #F2405F; }
        .rates-table td {
            padding: 12px;
            vertical-align: middle;
        }
        .rates-label { font-weight: 600; }
        .rates-sub   { font-size: 12px; opacity: 0.9; }
        .rates-price { text-align: right; font-weight: 700; }

        .details-grid {
            display: grid;
            grid-template-columns: 1fr auto;
            column-gap: 24px;
            row-gap: 4px;
            font-size: 14px;
            margin-top: 24px;
            padding-top: 10px;
            border-top: 1px solid rgba(255,255,255,0.15);
        }
        .detail-item-title { font-weight: 600; text-align: left; }
        .detail-price      { text-align: right; font-weight: 600; }

        .hotel-name {
            font-size: 16px;
            font-weight: 700;
            text-align: center;
            margin-top: 16px;
        }

        .footer-text {
            font-size: 11px;
            margin-top: 6px;
            line-height: 1.3;
            opacity: 0.85;
        }

        .panel-bottom { margin-top: auto; }

        /* Widgets colonne droite */
        .widgets {
            display: flex;
            flex-direction: column;
            gap: 12px;
            flex: 1;
            min-height: 0;
        }
        .widget {
            background: #151515;
            border-radius: 14px;
            padding: 12px 14px;
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        .widget-sticky {
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .widget-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .widget-title {
            font-size: 20px;
            font-weight: 600;
        }
        .widget-sub {
            font-size: 12px;
            opacity: 0.7;
        }

        /* M√©t√©o */
        .weather-main {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
        }
        .weather-left {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        .weather-temp {
            font-size: 40px;
            font-weight: 700;
        }
        .weather-desc {
            font-size: 14px;
            opacity: 0.9;
        }
        .weather-icon {
            font-size: 40px;
        }
        .weather-extra {
            display: flex;
            gap: 16px;
            font-size: 12px;
            opacity: 0.8;
            margin-top: 4px;
            flex-wrap: wrap;
        }

        .weather-days {
            display: flex;
            flex-direction: column;
            gap: 6px;
            margin-top: 8px;
            font-size: 13px;
        }
        .weather-day {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            padding: 4px 8px;
        }
        .weather-day-left {
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .weather-day-label { font-weight: 600; }
        .weather-day-icon  { font-size: 18px; }

        /* Menu du jour */
        .menu-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 4px;
        }
        .menu-items {
            font-size: 14px;
            line-height: 1.4;
        }

        /* Infos importantes */
        .info-item {
            font-size: 14px;
            line-height: 1.4;
            margin-bottom: 4px;
        }

        /* Photos / carrousel */
        .photo-wrapper {
            position: relative;
            height: 260px;
            border-radius: 12px;
            overflow: hidden;
            background: #000;
        }
        .photo-wrapper img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }
        .photo-caption {
            position: absolute;
            left: 0;
            right: 0;
            bottom: 0;
            padding: 6px 10px;
            font-size: 13px;
            background: linear-gradient(to top, rgba(0,0,0,0.8), transparent);
        }

        @media (max-width: 600px) {
            body {
                height: auto;
                overflow-y: auto;
            }
            .layout {
                grid-template-columns: 1fr;
                width: 100%;
                height: auto;
                transform: none;
            }
            .panel-widgets {
                max-height: none;
                overflow-y: visible;
            }
        }
    </style>
</head>
<body>

<div class="logo-container">
    <img id="logo-img" src="" alt="Logo h√¥tel" />
</div>

<div class="layout" id="layout-root">

    <!-- COLONNE GAUCHE : TARIFS -->
    <div class="panel" id="panel-tarifs">
        <div class="panel-title">Prix des chambres</div>
        <div class="panel-subtitle">Net prices in ‚Ç¨ VAT / par jour ¬∑ per day</div>

        <div class="rate-header">
            <div>Room rates</div>
            <div class="rate-date" id="rate-date"></div>
        </div>

        <table class="rates-table">
            <thead>
            <tr>
                <th>Type de prestation</th>
                <th style="text-align:right;">Prix / Rates</th>
            </tr>
            </thead>
            <tbody id="rates-body"></tbody>
        </table>

        <div class="details-grid" id="details-grid"></div>

        <div class="panel-bottom">
            <div class="hotel-name" id="hotel-name">
                Bienvenue √† l'h√¥tel ibis Vitr√© Centre
            </div>
            <div class="footer-text" id="footer-text"></div>
        </div>
    </div>

    <!-- COLONNE DROITE : WIDGETS -->
    <div class="panel panel-widgets">
        <div class="widgets">

            <!-- INFOS IMPORTANTES -->
            <section class="widget widget-sticky" id="widget-infos">
                <div class="widget-header">
                    <div class="widget-title">Informations importantes</div>
                </div>
                <div id="infos-list"></div>
            </section>

            <!-- M√âT√âO -->
            <section class="widget" id="widget-meteo">
                <div class="widget-header">
                    <div>
                        <div class="widget-title">M√©t√©o</div>
                        <div class="widget-sub" id="weather-location">Vitr√©</div>
                    </div>
                    <div class="widget-sub" id="weather-updated">‚Äî</div>
                </div>

                <div class="weather-main">
                    <div class="weather-left">
                        <div class="weather-temp" id="weather-temp">--¬∞C</div>
                        <div class="weather-desc" id="weather-desc">Chargement‚Ä¶</div>
                        <div class="weather-extra">
                            <div id="weather-highlow"></div>
                            <div id="weather-humidity"></div>
                            <div id="weather-wind"></div>
                        </div>
                    </div>
                    <div class="weather-icon" id="weather-icon">‚òÄÔ∏è</div>
                </div>

                <!-- Deux sections : Aujourd'hui + Demain -->
                <div class="weather-days">
                    <div class="weather-day" id="weather-today">
                        <div class="weather-day-left">
                            <span class="weather-day-icon" id="weather-today-icon">‚òÄÔ∏è</span>
                            <span class="weather-day-label">Aujourd'hui</span>
                        </div>
                        <div id="weather-today-desc"></div>
                        <div id="weather-today-temp"></div>
                    </div>
                    <div class="weather-day" id="weather-tomorrow">
                        <div class="weather-day-left">
                            <span class="weather-day-icon" id="weather-tomorrow-icon">‚òÅÔ∏è</span>
                            <span class="weather-day-label">Demain</span>
                        </div>
                        <div id="weather-tomorrow-desc"></div>
                        <div id="weather-tomorrow-temp"></div>
                    </div>
                </div>
            </section>

            <!-- MENU DU JOUR -->
            <section class="widget" id="widget-menu">
                <div class="widget-header">
                    <div class="widget-title">Menu du jour</div>
                    <div class="widget-sub" id="menu-date"></div>
                </div>
                <div class="menu-title" id="menu-title">Chargement‚Ä¶</div>
                <div class="menu-items" id="menu-items"></div>
            </section>

            <!-- PHOTOS -->
            <section class="widget" id="widget-photos">
                <div class="widget-header">
                    <div class="widget-title">D√©couvrir l'h√¥tel</div>
                </div>
                <div class="photo-wrapper">
                    <img id="photo-img" src="" alt="Photo h√¥tel" />
                    <div class="photo-caption" id="photo-caption"></div>
                </div>
            </section>

        </div>
    </div>
</div>

<script>
    /********* 1. CONFIG G√âN√âRALE *********/

    const SHEET_PUB_ID = "2PACX-1vThauH2vp6V4TkYj6VbVV6BT3fz_ggJIlgVHOzo6EGXg3fJtoaGxdLjUW8_1cIcpw";

    const GID_TARIFS     = "618820453";
    const GID_DETAILS    = "126337975";
    const GID_MENU       = "695467279";
    const GID_INFOS      = "1342307900";
    const GID_PHOTOS     = "407579197";
    const GID_MENTIONS   = "1712757088";
    const GID_PARAMETRES = "1182660406"; // onglet "parametres" √† cr√©er

    const LAT = 48.123;
    const LON = -1.208;

    const DEFAULT_SETTINGS = {
        refreshMainMinutes: 10,     // temps de rafra√Æchissement des donn√©es (tarifs, menu, etc.)
        refreshWeatherMinutes: 20,  // temps de rafra√Æchissement m√©t√©o
        photoIntervalSeconds: 8,    // temps entre deux photos du carrousel
        weatherLocationLabel: "Vitr√©",
        screenWidthPx: null,        // largeur cible de la maquette (ex: 1920)
        screenHeightPx: null,       // hauteur cible (ex: 1080)
        uiScale: 1                  // facteur de zoom global
    };
    let SETTINGS = { ...DEFAULT_SETTINGS };

    let mainIntervalId = null;
    let weatherIntervalId = null;
    let photoRotationId = null;

    /********* UTILS *********/

    function fetchCsv(gid) {
        const url = `https://docs.google.com/spreadsheets/d/e/${SHEET_PUB_ID}/pub?gid=${gid}&single=true&output=csv`;
        return fetch(url)
            .then(r => {
                if (!r.ok) throw new Error("HTTP " + r.status);
                return r.text();
            })
            .then(text => parseCsv(text))
            .catch(err => {
                console.error("Erreur fetchCsv pour gid", gid, err);
                return [];
            });
    }

    function csvSplit(line) {
        const result = [];
        let current = "";
        let inQuotes = false;

        for (let i = 0; i < line.length; i++) {
            const char = line[i];
            if (char === '"') {
                if (inQuotes && i + 1 < line.length && line[i + 1] === '"') {
                    current += '"';
                    i++;
                } else {
                    inQuotes = !inQuotes;
                }
            } else if (char === ',' && !inQuotes) {
                result.push(current);
                current = "";
            } else {
                current += char;
            }
        }
        result.push(current);
        return result;
    }

    function parseCsv(text) {
        const lines = text.trim().split(/\r?\n/);
        if (lines.length === 0) return [];
        const headerCols = csvSplit(lines[0]).map(h => h.trim());
        const rows = [];

        for (let idx = 1; idx < lines.length; idx++) {
            const line = lines[idx];
            if (!line.trim()) continue;
            const cols = csvSplit(line);
            const obj = {};
            headerCols.forEach((h, i) => {
                let val = cols[i] || "";
                val = val.replace(/^"(.*)"$/s, "$1").replace(/""/g, '"');
                obj[h] = val.trim();
            });
            rows.push(obj);
        }
        return rows;
    }

    function escapeHtml(str) {
        return str
            .replace(/&/g, "&amp;")
            .replace(/</g, "&lt;")
            .replace(/>/g, "&gt;");
    }

    /********* 2. PARAM√àTRES (onglet parametres) *********/

    async function loadSettings() {
        try {
            const rows = await fetchCsv(GID_PARAMETRES);
            rows.forEach(r => {
                const key = (r["cle"] || "").trim().toLowerCase();
                const value = (r["valeur"] || "").trim();
                if (!key) return;

                switch (key) {
                    case "refresh_main_minutes": {
                        const rm = parseInt(value, 10);
                        if (!isNaN(rm) && rm > 0) SETTINGS.refreshMainMinutes = rm;
                        break;
                    }
                    case "refresh_weather_minutes": {
                        const rw = parseInt(value, 10);
                        if (!isNaN(rw) && rw > 0) SETTINGS.refreshWeatherMinutes = rw;
                        break;
                    }
                    case "photo_interval_seconds": {
                        const ps = parseInt(value, 10);
                        if (!isNaN(ps) && ps > 0) SETTINGS.photoIntervalSeconds = ps;
                        break;
                    }
                    case "weather_location_label":
                        if (value) SETTINGS.weatherLocationLabel = value;
                        break;
                    case "screen_width_px": {
                        const sw = parseInt(value, 10);
                        if (!isNaN(sw) && sw > 0) SETTINGS.screenWidthPx = sw;
                        break;
                    }
                    case "screen_height_px": {
                        const sh = parseInt(value, 10);
                        if (!isNaN(sh) && sh > 0) SETTINGS.screenHeightPx = sh;
                        break;
                    }
                    case "ui_scale": {
                        const s = parseFloat(value.replace(",", "."));
                        if (!isNaN(s) && s > 0) SETTINGS.uiScale = s;
                        break;
                    }
                }
            });
        } catch (e) {
            console.error("Erreur loadSettings", e);
        }

        document.getElementById("weather-location").textContent = SETTINGS.weatherLocationLabel;
        applyScaling();
    }

    function applyScaling() {
        const root = document.getElementById("layout-root");
        if (!root) return;

        let scale = 1;

        if (SETTINGS.screenWidthPx && SETTINGS.screenHeightPx) {
            const sx = window.innerWidth / SETTINGS.screenWidthPx;
            const sy = window.innerHeight / SETTINGS.screenHeightPx;
            scale = Math.min(sx, sy);
        }

        if (SETTINGS.uiScale && SETTINGS.uiScale > 0) {
            scale *= SETTINGS.uiScale;
        }

        root.style.transform = `scale(${scale})`;
    }

    function setupIntervals() {
        const mainMs = SETTINGS.refreshMainMinutes * 60 * 1000;
        const weatherMs = SETTINGS.refreshWeatherMinutes * 60 * 1000;

        if (mainIntervalId) clearInterval(mainIntervalId);
        if (weatherIntervalId) clearInterval(weatherIntervalId);

        mainIntervalId = setInterval(() => {
            loadTarifs();
            loadMenu();
            loadInfos();
            loadMentions();
            loadPhotos();
        }, mainMs);

        weatherIntervalId = setInterval(loadWeather, weatherMs);
    }

    window.addEventListener("resize", applyScaling);

    /********* 3. TARIFS & D√âTAILS *********/

    function loadTarifs() {
        fetchCsv(GID_TARIFS).then(rows => {
            const tbody = document.getElementById("rates-body");
            tbody.innerHTML = "";
            rows.forEach(r => {
                const tr = document.createElement("tr");
                tr.innerHTML = `
                    <td>
                        <div class="rates-label">${escapeHtml(r["type"] || "")}</div>
                        <div class="rates-sub">${escapeHtml(r["sous_titre"] || "")}</div>
                    </td>
                    <td class="rates-price">${escapeHtml(r["prix"] || "")}</td>
                `;
                tbody.appendChild(tr);
            });
        });

        fetchCsv(GID_DETAILS).then(rows => {
            const container = document.getElementById("details-grid");
            container.innerHTML = "";
            rows.forEach(r => {
                const lib = (r["libelle"] || "").trim();
                const prix = (r["prix"] || "").trim();
                if (!lib && !prix) return;

                const labelDiv = document.createElement("div");
                labelDiv.className = "detail-item-title";
                labelDiv.textContent = lib;

                const priceDiv = document.createElement("div");
                priceDiv.className = "detail-price";
                priceDiv.textContent = prix;

                container.appendChild(labelDiv);
                container.appendChild(priceDiv);
            });
        });

        const dateEl = document.getElementById("rate-date");
        const now = new Date();
        const formatter = new Intl.DateTimeFormat("fr-FR", {
            weekday: "long", day: "numeric", month: "long", year: "numeric"
        });
        dateEl.textContent = formatter.format(now);
    }

    /********* 4. M√âT√âO (2 sections + ic√¥nes) *********/

    function mapWeatherCodeLabel(code) {
        if (code === 0) return "Ciel d√©gag√©";
        if ([1,2,3].includes(code)) return "Partiellement nuageux";
        if ([45,48].includes(code)) return "Brouillard";
        if ([51,53,55,56,57].includes(code)) return "Bruine";
        if ([61,63,65].includes(code)) return "Pluie";
        if ([71,73,75,77].includes(code)) return "Neige";
        if ([80,81,82].includes(code)) return "Averses";
        if ([95,96,99].includes(code)) return "Orages";
        return "Conditions variables";
    }

    function mapWeatherCodeIcon(code) {
        if (code === 0) return "‚òÄÔ∏è";
        if ([1,2,3].includes(code)) return "üå§Ô∏è";
        if ([45,48].includes(code)) return "üå´Ô∏è";
        if ([51,53,55,56,57].includes(code)) return "üå¶Ô∏è";
        if ([61,63,65].includes(code)) return "üåßÔ∏è";
        if ([71,73,75,77].includes(code)) return "‚ùÑÔ∏è";
        if ([80,81,82].includes(code)) return "üåßÔ∏è";
        if ([95,96,99].includes(code)) return "‚õàÔ∏è";
        return "‚òÅÔ∏è";
    }

    function loadWeather() {
        const url = `https://api.open-meteo.com/v1/forecast?latitude=${LAT}&longitude=${LON}&current=temperature_2m,weather_code,relative_humidity_2m,wind_speed_10m&daily=temperature_2m_max,temperature_2m_min,weather_code&timezone=auto`;
        fetch(url)
            .then(r => r.json())
            .then(data => {
                const current = data.current;
                const daily = data.daily;

                // Bloc principal
                document.getElementById("weather-temp").textContent =
                    Math.round(current.temperature_2m) + "¬∞C";
                document.getElementById("weather-desc").textContent =
                    mapWeatherCodeLabel(current.weather_code);
                document.getElementById("weather-icon").textContent =
                    mapWeatherCodeIcon(current.weather_code);

                document.getElementById("weather-highlow").textContent =
                    "Max " + Math.round(daily.temperature_2m_max[0]) +
                    "¬∞ / Min " + Math.round(daily.temperature_2m_min[0]) + "¬∞";
                document.getElementById("weather-humidity").textContent =
                    "Humidit√© " + Math.round(current.relative_humidity_2m) + "%";
                document.getElementById("weather-wind").textContent =
                    "Vent " + Math.round(current.wind_speed_10m) + " km/h";

                const updated = new Date(current.time);
                document.getElementById("weather-updated").textContent =
                    "Maj " + updated.toLocaleTimeString("fr-FR", {hour: "2-digit", minute: "2-digit"});

                // Aujourd'hui
                const todayCode = daily.weather_code[0];
                const todayMax  = Math.round(daily.temperature_2m_max[0]);
                const todayMin  = Math.round(daily.temperature_2m_min[0]);
                document.getElementById("weather-today-icon").textContent =
                    mapWeatherCodeIcon(todayCode);
                document.getElementById("weather-today-desc").textContent =
                    mapWeatherCodeLabel(todayCode);
                document.getElementById("weather-today-temp").textContent =
                    todayMax + "¬∞ / " + todayMin + "¬∞";

                // Demain (si dispo)
                if (daily.time.length > 1) {
                    const tomorrowCode = daily.weather_code[1];
                    const tomorrowMax  = Math.round(daily.temperature_2m_max[1]);
                    const tomorrowMin  = Math.round(daily.temperature_2m_min[1]);
                    document.getElementById("weather-tomorrow-icon").textContent =
                        mapWeatherCodeIcon(tomorrowCode);
                    document.getElementById("weather-tomorrow-desc").textContent =
                        mapWeatherCodeLabel(tomorrowCode);
                    document.getElementById("weather-tomorrow-temp").textContent =
                        tomorrowMax + "¬∞ / " + tomorrowMin + "¬∞";
                }
            })
            .catch(err => {
                console.error(err);
                document.getElementById("weather-desc").textContent = "M√©t√©o indisponible";
            });
    }

    /********* 5. MENU DU JOUR (max 4 lignes) *********/

    function loadMenu() {
        const widgetMenu = document.getElementById("widget-menu");

        fetchCsv(GID_MENU).then(rows => {
            if (!rows.length) {
                widgetMenu.style.display = "none";
                return;
            }

            const menu = rows[0];
            const titre = (menu["titre"] || "").trim();
            const items = (menu["items"] || "").trim();

            // On collecte max 4 lignes depuis l‚Äôonglet "menu"
            // 1) si colonnes ligne1..ligne4 existent
            const lines = [];
            for (let i = 1; i <= 4; i++) {
                const key = "ligne" + i;
                if (menu[key] && menu[key].trim()) {
                    lines.push(menu[key].trim());
                }
            }

            // 2) sinon, fallback : on d√©coupe "items" sur les retours √† la ligne et on garde 4 lignes max
            if (!lines.length && items) {
                items.split(/\r?\n/).map(l => l.trim()).filter(Boolean).slice(0, 4).forEach(l => {
                    lines.push(l);
                });
            }

            if (!titre && !lines.length) {
                widgetMenu.style.display = "none";
                return;
            }

            widgetMenu.style.display = "";
            document.getElementById("menu-title").textContent = titre || "Menu du jour";

            const html = lines
                .map(l => "‚Ä¢ " + escapeHtml(l))
                .join("<br>");
            document.getElementById("menu-items").innerHTML = html;
        });

        const now = new Date();
        document.getElementById("menu-date").textContent =
            now.toLocaleDateString("fr-FR", {weekday: "long", day: "numeric", month: "long"});
    }

    /********* 6. INFOS IMPORTANTES *********/

    function loadInfos() {
        const container = document.getElementById("infos-list");
        const widgetInfos = document.getElementById("widget-infos");

        fetchCsv(GID_INFOS).then(rows => {
            container.innerHTML = "";
            let count = 0;

            rows.forEach(r => {
                const texte = (r["texte"] || "").trim();
                if (!texte) return;
                const div = document.createElement("div");
                div.className = "info-item";
                div.textContent = "‚Ä¢ " + texte;
                container.appendChild(div);
                count++;
            });

            widgetInfos.style.display = (count === 0) ? "none" : "";
        });
    }

    /********* 7. MENTIONS *********/

    function loadMentions() {
        fetchCsv(GID_MENTIONS).then(rows => {
            if (!rows.length) return;
            const mention = rows[0]["mention"] || "";
            document.getElementById("footer-text").textContent = mention;
        });
    }

    /********* 8. PHOTOS + LOGO *********/

    let photos = [];
    let currentPhoto = 0;
    let logoPhoto = null;

    function loadPhotos() {
        const widgetPhotos = document.getElementById("widget-photos");

        fetchCsv(GID_PHOTOS).then(rows => {
            photos = [];
            logoPhoto = null;

            const dataRows = rows.filter(r => (r["url"] || "").trim() !== "");

            if (!dataRows.length) {
                const logoImg = document.getElementById("logo-img");
                logoImg.style.display = "none";
                widgetPhotos.style.display = "none";
                if (photoRotationId) {
                    clearInterval(photoRotationId);
                    photoRotationId = null;
                }
                return;
            }

            let candidateLogo = dataRows.find(r => {
                const legend = (r["legende"] || "").toLowerCase();
                return legend.includes("logo");
            });
            if (!candidateLogo) candidateLogo = dataRows[0];

            logoPhoto = candidateLogo;

            const logoImg = document.getElementById("logo-img");
            logoImg.src = (logoPhoto["url"] || "").trim();
            logoImg.alt = logoPhoto["legende"] || "Logo h√¥tel";
            logoImg.style.display = "block";

            photos = dataRows.filter(r => r !== logoPhoto);

            if (!photos.length) {
                widgetPhotos.style.display = "none";
                if (photoRotationId) {
                    clearInterval(photoRotationId);
                    photoRotationId = null;
                }
                return;
            } else {
                widgetPhotos.style.display = "";
            }

            currentPhoto = 0;
            showPhoto();

            if (photoRotationId) clearInterval(photoRotationId);
            const intervalMs = SETTINGS.photoIntervalSeconds * 1000;
            photoRotationId = setInterval(() => {
                currentPhoto = (currentPhoto + 1) % photos.length;
                showPhoto();
            }, intervalMs);
        });
    }

    function showPhoto() {
        if (!photos.length) return;
        const p = photos[currentPhoto];
        const url = (p["url"] || "").trim();

        const img = document.getElementById("photo-img");
        img.src = url;
        img.alt = p["legende"] || "";
        document.getElementById("photo-caption").textContent = p["legende"] || "";
    }

    /********* 9. INIT *********/

    async function init() {
        await loadSettings();
        loadTarifs();
        loadWeather();
        loadMenu();
        loadInfos();
        loadPhotos();
        loadMentions();
        setupIntervals();
    }

    init();
</script>
</body>
</html>
