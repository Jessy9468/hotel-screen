<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8" />
    <title>Écran tarifs & infos - Ibis Vitré</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        html, body {
            height: 100%;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            background: #000;
            color: #fff;
        }
        body {
            overflow: hidden;
        }

        /* LOGO EN HAUT À DROITE (background-image) */
        .logo-container {
            position: fixed;
            top: 12px;
            right: 24px;
            z-index: 20;
            width: 120px;
            height: 70px;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.6));
        }

        /* STRUCTURE */
        .layout {
            display: grid;
            grid-template-columns: 1.25fr 1fr;
            gap: 16px;
            padding: 16px;
            height: 100vh;
        }
        .panel {
            background: #111;
            border-radius: 16px;
            padding: 16px 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.4);
            display: flex;
            flex-direction: column;
        }
        .panel-widgets { overflow-y: auto; overflow-x: hidden; }

        .panel-title {
            font-size: 28px; font-weight: 700;
            text-align: center; margin-bottom: 10px;
        }
        .panel-subtitle {
            font-size: 14px; text-align: center;
            opacity: 0.8; margin-bottom: 12px;
        }

        /* TABLEAU TARIFS */
        .rate-header { display: flex; justify-content: space-between; margin-bottom: 8px; }
        .rate-date { font-weight: 600; }

        .rates-table { width: 100%; border-collapse: collapse; margin-top: 8px; }
        .rates-table thead tr { background: #CC0033; }
        .rates-table th { padding: 10px 12px; font-size: 14px; }
        .rates-table tbody tr:nth-child(odd) { background: #E5093B; }
        .rates-table tbody tr:nth-child(even) { background: #F2405F; }
        .rates-table td { padding: 12px; }

        .rates-label { font-weight: 600; }
        .rates-sub { font-size: 12px; opacity: 0.9; }
        .rates-price { text-align: right; font-weight: 700; }

        .details-grid {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 4px 24px;
            margin-top: 28px;
            padding-top: 12px;
            border-top: 1px solid rgba(255,255,255,0.2);
        }

        .detail-item-title { font-weight: 600; }
        .detail-price { font-weight: 600; text-align: right; }

        /* BAS DE PAGE GAUCHE */
        .panel-bottom { margin-top: auto; }
        .hotel-name { font-size: 16px; font-weight: 700; text-align: center; margin-top: 20px; }
        .footer-text { font-size: 11px; opacity: 0.85; margin-top: 8px; line-height: 1.3; }

        /* WIDGETS */
        .widgets { display: flex; flex-direction: column; gap: 14px; }
        .widget {
            background: #151515;
            border-radius: 14px;
            padding: 14px;
        }
        .widget-sticky { position: sticky; top: 0; z-index: 10; }

        .widget-title { font-size: 20px; font-weight: 600; margin-bottom: 4px; }
        .widget-sub { font-size: 12px; opacity: 0.7; }

        /* METEO */
        .weather-block {
            padding: 10px;
            background: rgba(255,255,255,0.06);
            border-radius: 12px;
            margin-top: 10px;
        }
        .weather-day-title {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 6px;
        }
        .weather-temp-big { font-size: 40px; font-weight: 700; }
        .weather-desc { opacity: 0.85; margin-bottom: 4px; }
        .weather-small-info { font-size: 12px; opacity: 0.7; }

        /* CARROUSEL PHOTOS (background-image) */
        .photo-wrapper {
            height: 280px;
            border-radius: 14px;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            position: relative;
            overflow: hidden;
        }
        .photo-caption {
            position: absolute;
            bottom: 0;
            width: 100%;
            padding: 8px;
            background: linear-gradient(to top, rgba(0,0,0,0.7), transparent);
            font-size: 14px;
        }

    </style>
</head>
<body>

<!-- LOGO -->
<div class="logo-container" id="logo-container"></div>

<div class="layout">

    <!-- COLONNE GAUCHE -->
    <div class="panel">
        <div class="panel-title">Prix des chambres</div>
        <div class="panel-subtitle">Net prices in € VAT / par jour · per day</div>

        <div class="rate-header">
            <div>Room rates</div>
            <div id="rate-date"></div>
        </div>

        <table class="rates-table">
            <thead>
                <tr>
                    <th>Type de prestation</th>
                    <th style="text-align:right;">Prix / Rates</th>
                </tr>
            </thead>
            <tbody id="rates-body"></tbody>
        </table>

        <div class="details-grid" id="details-grid"></div>

        <div class="panel-bottom">
            <div class="hotel-name">Bienvenue à l'hôtel ibis Vitré Centre</div>
            <div class="footer-text" id="footer-text"></div>
        </div>
    </div>

    <!-- COLONNE DROITE -->
    <div class="panel panel-widgets">
        <div class="widgets">

            <!-- INFOS IMPORTANTES -->
            <div class="widget widget-sticky" id="widget-infos">
                <div class="widget-title">Informations importantes</div>
                <div id="infos-list"></div>
            </div>

            <!-- METEO AUJOURD'HUI -->
            <div class="widget">
                <div class="widget-title">Météo aujourd'hui</div>
                <div id="weather-today" class="weather-block"></div>
            </div>

            <!-- METEO DEMAIN -->
            <div class="widget">
                <div class="widget-title">Météo demain</div>
                <div id="weather-tomorrow" class="weather-block"></div>
            </div>

            <!-- MENU DU JOUR -->
            <div class="widget" id="widget-menu">
                <div class="widget-title">Menu du jour</div>
                <div class="widget-sub" id="menu-date"></div>
                <div id="menu-title"></div>
                <div id="menu-items"></div>
            </div>

            <!-- PHOTOS -->
            <div class="widget" id="widget-photos">
                <div class="widget-title">Découvrir l'hôtel</div>
                <div class="photo-wrapper" id="photo-wrapper">
                    <div class="photo-caption" id="photo-caption"></div>
                </div>
            </div>

        </div>
    </div>
</div>

<script>
/* ---------------- CONFIG ---------------- */
const SHEET_PUB_ID = "2PACX-1vThauH2vp6V4TkYj6VbVV6BT3fz_ggJIlgVHOzo6EGXg3fJtoaGxdLjUW8_1cIcpw";

const GID_TARIFS   = "618820453";
const GID_DETAILS  = "126337975";
const GID_MENU     = "695467279";
const GID_INFOS    = "1342307900";
const GID_PHOTOS   = "407579197";
const GID_MENTIONS = "1712757088";

const LAT = 48.123;
const LON = -1.208;

/* -------------- UTILITAIRE CSV --------------- */
function fetchCsv(gid){
    const url = `https://docs.google.com/spreadsheets/d/e/${SHEET_PUB_ID}/pub?gid=${gid}&single=true&output=csv`;
    return fetch(url).then(r=>r.text()).then(parseCsv);
}
function parseCsv(text){
    const lines = text.split(/\r?\n/);
    const headers = lines[0].split(",");
    return lines.slice(1).map(l => {
        const cols = l.split(",");
        const obj = {};
        headers.forEach((h,i)=>obj[h.trim().toLowerCase()] = (cols[i]||"").trim());
        return obj;
    });
}

/* ------------------- TARIFS ------------------- */
function loadTarifs(){
    fetchCsv(GID_TARIFS).then(rows=>{
        const tbody=document.getElementById("rates-body");
        tbody.innerHTML="";
        rows.forEach(r=>{
            const tr=document.createElement("tr");
            tr.innerHTML = `
                <td>
                    <div class="rates-label">${r.type}</div>
                    <div class="rates-sub">${r.sous_titre}</div>
                </td>
                <td class="rates-price">${r.prix}</td>`;
            tbody.appendChild(tr);
        });
    });

    fetchCsv(GID_DETAILS).then(rows=>{
        const grid=document.getElementById("details-grid");
        grid.innerHTML="";
        rows.forEach(r=>{
            if(!r.libelle) return;
            grid.innerHTML += `
                <div class="detail-item-title">${r.libelle}</div>
                <div class="detail-price">${r.prix||""}</div>`;
        });
    });

    document.getElementById("rate-date").textContent =
        new Date().toLocaleDateString("fr-FR",{weekday:"long",day:"numeric",month:"long"});
}

/* ---------------- METEO (AUJOURD'HUI + DEMAIN) ---------------- */
function loadWeather(){
    const url = `https://api.open-meteo.com/v1/forecast?latitude=${LAT}&longitude=${LON}&current=temperature_2m,weather_code,relative_humidity_2m,wind_speed_10m&daily=temperature_2m_max,temperature_2m_min,weather_code&timezone=auto`;

    fetch(url).then(r=>r.json()).then(data=>{
        const today = `
            <div class="weather-day-title">Aujourd'hui</div>
            <div class="weather-temp-big">${Math.round(data.current.temperature_2m)}°C</div>
            <div class="weather-desc">${mapWeather(data.current.weather_code)}</div>
            <div class="weather-small-info">Max ${Math.round(data.daily.temperature_2m_max[0])}° / Min ${Math.round(data.daily.temperature_2m_min[0])}°</div>
            <div class="weather-small-info">Humidité : ${data.current.relative_humidity_2m}%</div>
            <div class="weather-small-info">Vent : ${Math.round(data.current.wind_speed_10m)} km/h</div>
        `;
        const tomorrow = `
            <div class="weather-day-title">Demain</div>
            <div class="weather-desc">${mapWeather(data.daily.weather_code[1])}</div>
            <div class="weather-small-info">Max ${Math.round(data.daily.temperature_2m_max[1])}° / Min ${Math.round(data.daily.temperature_2m_min[1])}°</div>
        `;

        document.getElementById("weather-today").innerHTML = today;
        document.getElementById("weather-tomorrow").innerHTML = tomorrow;
    });
}
function mapWeather(code){
    if(code===0) return "Ciel dégagé";
    if([1,2,3].includes(code)) return "Partiellement nuageux";
    if([45,48].includes(code)) return "Brouillard";
    if([51,53,55].includes(code)) return "Bruine";
    if([61,63,65].includes(code)) return "Pluie";
    if([71,73,75].includes(code)) return "Neige";
    if([80,81,82].includes(code)) return "Averses";
    if([95,96,99].includes(code)) return "Orage";
    return "Conditions variables";
}

/* ---------------- MENU ---------------- */
function loadMenu(){
    fetchCsv(GID_MENU).then(rows=>{
        if(!rows.length) return document.getElementById("widget-menu").style.display="none";
        const r=rows[0];
        document.getElementById("menu-date").textContent =
            new Date().toLocaleDateString("fr-FR",{weekday:"long",day:"numeric",month:"long"});
        document.getElementById("menu-title").textContent = r.titre;
        document.getElementById("menu-items").innerHTML = r.items.replace(/\n/g,"<br>");
    });
}

/* ---------------- INFOS IMPORTANTES ---------------- */
function loadInfos(){
    fetchCsv(GID_INFOS).then(rows=>{
        const box=document.getElementById("infos-list");
        box.innerHTML="";
        rows.forEach(r=>{
            if(r.texte) box.innerHTML+=`<div class="info-item">• ${r.texte}</div>`;
        });
    });
}

/* ---------------- MENTIONS ---------------- */
function loadMentions(){
    fetchCsv(GID_MENTIONS).then(rows=>{
        if(rows.length)
            document.getElementById("footer-text").textContent = rows[0].mention;
    });
}

/* ---------------- PHOTOS + LOGO ---------------- */
let photos=[];
let currentPhoto=0;
let logoPhoto=null;

function loadPhotos(){
    fetchCsv(GID_PHOTOS).then(rows=>{
        const clean = rows.filter(r=>r.url);

        /* 1) détecter logo */
        logoPhoto = clean.find(r => (r.legende||"").toLowerCase().includes("logo")) || clean[0];

        /* appliquer logo en background-image */
        document.getElementById("logo-container").style.backgroundImage = `url("${logoPhoto.url}")`;

        /* 2) autres photos = carrousel */
        photos = clean.filter(r => r !== logoPhoto);

        if(!photos.length){
            document.getElementById("widget-photos").style.display="none";
            return;
        }

        showPhoto();
        setInterval(()=>{
            currentPhoto = (currentPhoto+1)%photos.length;
            showPhoto();
        }, 6000);
    });
}

function showPhoto(){
    const p = photos[currentPhoto];
    const wrapper=document.getElementById("photo-wrapper");
    wrapper.style.backgroundImage = `url("${p.url}")`;
    document.getElementById("photo-caption").textContent = p.legende||"";
}

/* ---------------- INIT ---------------- */
function init(){
    loadTarifs();
    loadWeather();
    loadMenu();
    loadInfos();
    loadMentions();
    loadPhotos();
}
init();
</script>

</body>
</html>
